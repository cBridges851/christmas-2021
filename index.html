<html>
  <head>
    <script src="https://aframe.io/releases/1.0.4/aframe.min.js"></script>
    <script src="https://cdn.rawgit.com/matthewbryancurtis/aframe-star-system-component/db4f1030/index.js"></script>
    <script src="https://rawgit.com/protyze/aframe-curve-component/master/dist/aframe-curve-component.min.js"></script>
    <script src="https://rawgit.com/protyze/aframe-alongpath-component/master/dist/aframe-alongpath-component.min.js"></script>
    <title>Merry Christmas Everyone!</title>
    <link rel="icon" href="static/images/icon.svg" />
  </head>
  <body>
    <a-scene background="color: #000000">
      <a-assets>
        <img id="sun" src="./static/images/sun.jpg" />
        <img id="mercury" src="./static/images/mercury.jpg" />
        <img id="venus" src="./static/images/venus.jpg" />
        <img id="earth" src="./static/images/earth.jpg" />
        <img id="mars" src="./static/images/mars.jpg" />
        <img id="jupiter" src="./static/images/jupiter.jpg" />
        <img id="saturn" src="./static/images/saturn.jpg" />
        <img id="uranus" src="./static/images/uranus.jpg" />
        <img id="neptune" src="./static/images/neptune.jpg" />
        <audio id="background-music" src="./static/sound/space.wav"></audio>
        <a-asset-item id="christmas-tree" src="./static/models/ChristmasTree/ChristmasTree.glb"></a-asset-item>
        <a-asset-item id="astronaut" src="./static/models/ChristmasAstronaut/ChristmasAstronaut.glb"></a-asset-item>
        <a-asset-item id="asteroid" src="./static/models/Asteroid/Asteroid.glb"></a-asset-item>
        <a-asset-item id="red-flying-saucer" src="./static/models/FlyingSaucer/RedFlyingSaucer.glb"></a-asset-item>
        <a-asset-item id="green-flying-saucer" src="./static/models/FlyingSaucer/GreenFlyingSaucer.glb"></a-asset-item>
        <a-asset-item id="gold-flying-saucer" src="./static/models/FlyingSaucer/GoldFlyingSaucer.glb"></a-asset-item>
        <a-asset-item id="ornament-string" src="./static/models/OrnamentString/OrnamentString.glb"></a-asset-item>
        <a-asset-item id="nakatomi-plaza-sign" src="./static/models/NakatomiPlazaSign/NakatomiPlazaSign.glb"></a-asset-item>
      </a-assets>
      <a-entity star-system></a-entity>
      <a-entity camera look-controls wasd-controls="acceleration: 1000"></a-entity>
      <a-light 
        type="ambient" 
        position="-81 88 -108" 
        intensity="1.5">
      </a-light>
      <a-sound 
        src="#background-music" 
        autoplay="false" 
        loop="true">
      </a-sound>
      <a-entity 
        gltf-model="#christmas-tree" 
        position="-80 -60 -110" 
        scale="0.5 0.5 0.5">
      </a-entity>
      <a-entity 
        gltf-model="#astronaut" 
        position="80 -55 -110" 
        scale="0.4 0.4 0.4" 
        rotation="-15 -50 0" 
        animation="
            property: object3D.position.y;
            to: -51; 
            dir: alternate; 
            dur: 1000; 
            loop: true">
      </a-entity>
      <a-entity 
        gltf-model="#red-flying-saucer" 
        position="-1000 250 -610"
        animation="
          property: rotation; 
          to: 0 360 0; 
          loop: true; 
          dur: 6000"
        animation__2="
          property: position;
          to: 1000 250 -610;
          loop: true;
          dir: alternate;
          dur: 10000;
        ">
      </a-entity>
      <a-entity 
        gltf-model="#red-flying-saucer" 
        position="1000 50 -610"
        animation="
          property: rotation; 
          to: 0 360 0; 
          loop: true; 
          dur: 6000"
        animation__2="
          property: position;
          to: -1000 50 -610;
          loop: true;
          dir: alternate;
          dur: 10000;
        ">
      </a-entity>
      <a-curve id="track__green-flying-saucer-1">
        <a-curve-point position="1000 150 500"></a-curve-point>
        <a-curve-point position="1000 150 -500"></a-curve-point>
        <a-curve-point position="0 150 -1000"></a-curve-point>
        <a-curve-point position="-1000 150 -500"></a-curve-point>
        <a-curve-point position="-1000 150 500"></a-curve-point>
        <a-curve-point position="0 150 1000"></a-curve-point>
        <a-curve-point position="1000 150 500"></a-curve-point>
      </a-curve>
      <a-entity 
        gltf-model="#green-flying-saucer" 
        position="0 0 1000"
        alongpath="
          curve: #track__green-flying-saucer-1; 
          loop: true; 
          rotate: true; 
          dur: 50000"
        animation="
          property: rotation; 
          to: 0 360 0; 
          loop: true; 
          dur: 6000">
      </a-entity>
      <a-curve id="track__gold-flying-saucer-1">
        <a-curve-point position="-500 600 -250"></a-curve-point>
        <a-curve-point position="-500 600 250"></a-curve-point>
        <a-curve-point position="0 600 500"></a-curve-point>
        <a-curve-point position="500 600 250"></a-curve-point>
        <a-curve-point position="500 600 -250"></a-curve-point>
        <a-curve-point position="0 600 -500"></a-curve-point>
        <a-curve-point position="-500 600 -250"></a-curve-point>
      </a-curve>
      <a-entity 
        gltf-model="#gold-flying-saucer" 
        position="0 600 -1000"
        alongpath="
          curve: #track__gold-flying-saucer-1; 
          loop: true; 
          rotate: true; 
          dur: 50000"
        animation="
          property: rotation; 
          to: 0 360 0; 
          loop: true; 
          dur: 6000">
      </a-entity>
      <a-entity 
        gltf-model="#ornament-string" 
        position="-59 5.4 -110"
        scale="0.2 0.2 0.2">
      </a-entity>
      <a-entity 
        gltf-model="#nakatomi-plaza-sign" 
        position="-56.7 -1 -115"
        rotation="15 0 0"
        scale="0.1 0.1 0.1">
      </a-entity>
      <a-text 
        value="Merry"
        font="./static/fonts/Gwendolyn-Bold-msdf.json"
        color="#FFFFFF"
        negate="false"
        scale="100 100 100"
        position="-50 80 -110">
      </a-text>
      <a-text 
        value="Christmas"
        font="./static/fonts/Gwendolyn-Bold-msdf.json"
        color="#FFFFFF"
        negate="false"
        scale="100 100 100"
        position="-40 50 -110">
      </a-text>
      <a-text
        id="customOutput"
        font="./static/fonts/Gwendolyn-Bold-msdf.json"
        color="#FFFFFF"
        negate="false"
        scale="100 100 100"
        position="-30 20 -110">
      </a-text>
    </a-scene>
    <script src="./static/scripts/SolarSystem.js"></script>
    <script src="./static/scripts/CustomTextHandler.js"></script>
    <script src="./static/scripts/AsteroidHandler.js"></script>
    <script>
      window.addEventListener("load", async () => {
        const solarSystem = new SolarSystem();
        const customTextHandler = new CustomTextHandler();
        const asteroidHandler = new AsteroidHandler();

        fetch("./static/scripts/planets.json")
        .then(response => response.json())
        .then(jsonResponse => {
          solarSystem.generateSun();
          solarSystem.generatePlanets(jsonResponse["planets"]);
          solarSystem.generateRings([jsonResponse["planets"][5], jsonResponse["planets"][6]]);
          solarSystem.generateAsteroids();
          solarSystem.generateOrnamentStrings(jsonResponse["planets"]);

          const params = customTextHandler.receiveParameters();
          customTextHandler.updateText(params);
          const asteroids = asteroidHandler.collateAsteroids();

          for (const asteroid of asteroids) {
            const initialPosition = asteroidHandler.generateNewPosition();
            asteroidHandler.setInitialPosition(initialPosition, asteroid);
            const positions = asteroidHandler.generateNewPosition();
            asteroidHandler.travelToNewPosition(positions, asteroid);

            setInterval(() => {
              const positions = asteroidHandler.generateNewPosition();
              asteroidHandler.travelToNewPosition(positions, asteroid);
            }, 15000);
          }
        });
      });
    </script>
  </body>
</html>
